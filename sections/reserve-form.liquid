{% comment %}
  Reserve Form (The V Society)
  - Renders on product pages (template: product.reserve.json)
  - Sends a cart line item with customer details in properties
{% endcomment %}

{% if product and product.available %}
<section class="vs-reserve color-{{ section.settings.color_scheme }}">
  <div class="vs-wrap">
    <div class="vs-copy">
      {% if section.settings.kicker != blank %}
        <p class="vs-kicker">{{ section.settings.kicker }}</p>
      {% endif %}
      <h2 class="vs-title">{{ section.settings.heading | default: 'Reserve this piece' }}</h2>
      {% if section.settings.subheading != blank %}
        <p class="vs-sub">{{ section.settings.subheading }}</p>
      {% endif %}
    </div>

    <form method="post" action="/cart/add" class="vs-form" novalidate>
      <!-- Variant (hidden if only one) -->
      {% assign first_variant = product.selected_or_first_available_variant %}
      {% if product.has_only_default_variant %}
        <input type="hidden" name="id" value="{{ first_variant.id }}">
      {% else %}
        <label class="vs-label" for="vs-variant">Select option</label>
        <select id="vs-variant" name="id" class="vs-input" required>
          {% for v in product.variants %}
            <option value="{{ v.id }}" {% if v.id == first_variant.id %}selected{% endif %} {% unless v.available %}disabled{% endunless %}>
              {{ v.title }} {% unless v.available %}— Sold out{% endunless %}
            </option>
          {% endfor %}
        </select>
      {% endif %}

      <!-- Guest details captured as line item properties -->
      <div class="vs-grid">
        <div>
          <label class="vs-label" for="vs-name">Full name</label>
          <input class="vs-input" id="vs-name" type="text" name="properties[Name]" placeholder="Your name" required>
        </div>
        <div>
          <label class="vs-label" for="vs-email">Email</label>
          <input class="vs-input" id="vs-email" type="email" name="properties[Email]" placeholder="you@example.com" required>
        </div>
        <div>
          <label class="vs-label" for="vs-phone">Phone</label>
          <input class="vs-input" id="vs-phone" type="tel" name="properties[Phone]" placeholder="(xxx) xxx-xxxx">
        </div>
        <div>
          <label class="vs-label" for="vs-date">Preferred date</label>
          <input class="vs-input" id="vs-date" type="date" name="properties[Preferred date]">
        </div>
      </div>

      <label class="vs-label" for="vs-notes">Notes (optional)</label>
      <textarea class="vs-input vs-textarea" id="vs-notes" name="properties[Notes]" rows="4" placeholder="Sizing, color, special requests…"></textarea>

      <label class="vs-check">
        <input type="checkbox" required>
        <span>I agree this is a reservation request and not a final purchase.</span>
      </label>

      <button type="submit" class="vs-btn">
        {{ section.settings.button_label | default: 'Reserve Now' }}
      </button>

      {% if section.settings.secondary_link != blank and section.settings.secondary_label != blank %}
        <a href="{{ section.settings.secondary_link }}" class="vs-link">{{ section.settings.secondary_label }}</a>
      {% endif %}
    </form>

    {% if section.settings.disclaimer != blank %}
      <p class="vs-disclaimer">{{ section.settings.disclaimer }}</p>
    {% endif %}
  </div>
</section>
{% else %}
  <section class="vs-reserve color-{{ section.settings.color_scheme }}">
    <div class="vs-wrap">
      <h2 class="vs-title">Currently unavailable</h2>
      <p class="vs-sub">This item can’t be reserved at the moment.</p>
    </div>
  </section>
{% endif %}

<style>
  /* ---- The V Society – Reserve form styles (scoped) ---- */
  .vs-reserve { padding: 2.5rem 0 3rem; }
  .vs-wrap { max-width: 980px; margin: 0 auto; padding: 0 1rem; }
  .vs-kicker { letter-spacing:.12em; text-transform:uppercase; font-size:.78rem; opacity:.8; margin:0 0 .35rem }
  .vs-title { font-size: clamp(1.6rem, 2.2vw + 1rem, 2.4rem); line-height:1.2; margin:.2rem 0 .6rem }
  .vs-sub { font-size:1rem; opacity:.9; margin:0 0 1.25rem }

  .vs-form { margin-top: .75rem; }
  .vs-grid { display:grid; grid-template-columns: repeat(2,minmax(0,1fr)); gap: .9rem; margin-bottom:.9rem }
  @media (max-width: 700px){ .vs-grid{ grid-template-columns:1fr } }

  .vs-label { display:block; font-size:.85rem; margin: .35rem 0 .25rem; opacity:.9 }
  .vs-input, .vs-textarea, .vs-input select {
    width:100%; border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18); color: inherit; padding:.7rem .8rem;
    border-radius: .5rem; outline:none;
  }
  .color-scheme-1 .vs-input, .color-scheme-2 .vs-input, .color-scheme-3 .vs-input { background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.16); }
  .vs-input:focus, .vs-textarea:focus { box-shadow: 0 0 0 2px rgba(212,175,55,.35); }

  .vs-check { display:flex; align-items:center; gap:.5rem; margin:.75rem 0 1rem; font-size:.92rem; }
  .vs-check input{ transform:translateY(1px) }

  .vs-btn {
    display:inline-block; padding:.8rem 1.2rem; border-radius:.6rem;
    border:1px solid #D4AF37; background: linear-gradient(180deg,#F1D37A,#C79C2B);
    color:#111; font-weight:600; letter-spacing:.02em; text-transform:uppercase;
  }
  .vs-btn:hover { filter:brightness(1.03); transform: translateY(-1px); transition: .15s ease; }

  .vs-link { display:inline-block; margin-left:1rem; text-decoration:underline; opacity:.9 }
  .vs-disclaimer { margin-top: .9rem; font-size:.82rem; opacity:.75 }
</style>

{% schema %}
{
  "name": "Reserve form",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "kicker", "label": "Kicker", "default": "Private Client Services" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Reserve this piece" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "We’ll confirm availability and arrange delivery or pickup." },
    { "type": "text", "id": "button_label", "label": "Button label", "default": "Reserve Now" },
    { "type": "url", "id": "secondary_link", "label": "Optional second link" },
    { "type": "text", "id": "secondary_label", "label": "Second link label" },
    { "type": "textarea", "id": "disclaimer", "label": "Disclaimer", "default": "Reservations are not a final purchase. We will contact you to confirm details." },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-6" }
  ],
  "presets": [{ "name": "Reserve form" }]
}
{% endschema %}
